<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Demo UI Generativa - Biometría</title>
  <style>
    :root {
      --primary-color: #3b82f6;
      --bg-color: #0f172a;
      --card-bg: rgba(255, 255, 255, 0.1);
      --text-color: #f8fafc;
    }

    body {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
      background-color: var(--bg-color);
      color: var(--text-color);
      overflow: hidden;
      transition: background-color 1s ease;
    }

    /* Background Carousel */
    #bg-carousel {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      overflow: hidden;
    }

    .bg-image {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-size: cover;
      background-position: center;
      opacity: 0;
      transition: opacity 1.5s ease-in-out;
      filter: blur(20px) brightness(0.6);
    }

    .bg-image.active {
      opacity: 1;
    }

    /* Main Container */
    .container {
      display: flex;
      gap: 40px;
      align-items: center;
      z-index: 10;
    }

    /* Video & Canvas Wrapper */
    .video-wrapper {
      position: relative;
      width: 480px;
      height: 360px;
      border-radius: 24px;
      overflow: hidden;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    #video {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transform: scaleX(-1);
      /* Mirror effect */
    }

    #overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      transform: scaleX(-1);
      /* Mirror canvas too */
    }

    /* UI Card */
    .ui-card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      padding: 40px;
      border-radius: 24px;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
      width: 400px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: all 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
      text-align: left;
    }

    .ui-card h1 {
      margin: 0 0 10px 0;
      font-size: 2.5rem;
      font-weight: 700;
      background: linear-gradient(to right, #fff, #cbd5e1);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .ui-card p {
      font-size: 1.1rem;
      color: #cbd5e1;
      margin: 0;
      line-height: 1.6;
    }

    .ui-card .badge {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
      margin-bottom: 20px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    /* UI States */
    .ui-card.neutral {
      border-top: 4px solid #3b82f6;
    }

    .ui-card.neutral .badge {
      background: rgba(59, 130, 246, 0.2);
      color: #60a5fa;
    }

    .ui-card.happy {
      border-top: 4px solid #22c55e;
      transform: scale(1.02);
    }

    .ui-card.happy .badge {
      background: rgba(34, 197, 94, 0.2);
      color: #4ade80;
    }

    .ui-card.sad {
      border-top: 4px solid #ef4444;
    }

    .ui-card.sad .badge {
      background: rgba(239, 68, 68, 0.2);
      color: #f87171;
    }

    /* Image Carousel in Card */
    .card-image {
      width: 100%;
      height: 200px;
      border-radius: 16px;
      margin-top: 20px;
      background-size: cover;
      background-position: center;
      transition: background-image 0.5s ease-in-out;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }

    #status {
      position: absolute;
      bottom: 20px;
      color: rgba(255, 255, 255, 0.5);
      font-size: 0.9rem;
    }
  </style>
</head>

<body>

  <!-- Background Carousel -->
  <div id="bg-carousel">
    <div class="bg-image active" id="bg-neutral" style="background-image: url('images/neutral.png')"></div>
    <div class="bg-image" id="bg-happy" style="background-image: url('images/happy.png')"></div>
    <div class="bg-image" id="bg-sad" style="background-image: url('images/sad.png')"></div>
  </div>

  <div class="container">
    <!-- Video & Biometric Grid -->
    <div class="video-wrapper">
      <video id="video" autoplay muted playsinline></video>
      <canvas id="overlay"></canvas>
    </div>

    <!-- Generative UI Card -->
    <div id="ui-card" class="ui-card neutral">
      <span class="badge">Sistema Estable</span>
      <h1>Neutral</h1>
      <p>Interfaz balanceada. Detectando parámetros biométricos estables.</p>
      <div class="card-image" style="background-image: url('images/neutral.png')"></div>
    </div>
  </div>

  <div id="status">Iniciando sistema...</div>

  <!-- Cargar face-api.js desde CDN -->
  <script src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>

  <script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('overlay');
    const uiCard = document.getElementById('ui-card');
    const statusText = document.getElementById('status');
    const cardTitle = uiCard.querySelector('h1');
    const cardDesc = uiCard.querySelector('p');
    const cardBadge = uiCard.querySelector('.badge');
    const cardImage = uiCard.querySelector('.card-image');

    // Background elements
    const bgNeutral = document.getElementById('bg-neutral');
    const bgHappy = document.getElementById('bg-happy');
    const bgSad = document.getElementById('bg-sad');

    const MODEL_URL = './models';

    async function loadModels() {
      try {
        statusText.innerText = "Cargando modelos biométricos...";
        await faceapi.loadTinyFaceDetectorModel(MODEL_URL);
        await faceapi.loadFaceLandmarkModel(MODEL_URL);
        await faceapi.loadFaceExpressionModel(MODEL_URL);
        startVideo();
      } catch (err) {
        console.error("Error:", err);
        statusText.innerText = "Error: " + err.message;
      }
    }

    function startVideo() {
      navigator.mediaDevices.getUserMedia({ video: {} })
        .then(stream => {
          video.srcObject = stream;
          statusText.innerText = "Sistema activo";
        })
        .catch(err => console.error("Camera error:", err));
    }

    loadModels();

    video.addEventListener('play', () => {
      // Ajustar canvas al tamaño del video
      const displaySize = { width: video.offsetWidth, height: video.offsetHeight };
      faceapi.matchDimensions(canvas, displaySize);

      setInterval(async () => {
        const detections = await faceapi.detectAllFaces(video, new faceapi.TinyFaceDetectorOptions())
          .withFaceLandmarks()
          .withFaceExpressions();

        // Limpiar canvas
        const ctx = canvas.getContext('2d');
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        if (detections.length > 0) {
          const resizedDetections = faceapi.resizeResults(detections, displaySize);

          // Dibujar landmarks (Grid biométrico)
          faceapi.draw.drawFaceLandmarks(canvas, resizedDetections);

          // Obtener expresión
          const expressions = detections[0].expressions;
          const dominant = Object.keys(expressions).reduce((a, b) => expressions[a] > expressions[b] ? a : b);

          updateUI(dominant);
        } else {
          updateUI('neutral');
        }
      }, 100);
    });

    function updateUI(expression) {
      // Reset classes
      uiCard.classList.remove('neutral', 'happy', 'sad');

      // Reset backgrounds
      bgNeutral.classList.remove('active');
      bgHappy.classList.remove('active');
      bgSad.classList.remove('active');

      switch (expression) {
        case 'happy':
          uiCard.classList.add('happy');
          bgHappy.classList.add('active');

          cardBadge.innerText = "Energía Positiva";
          cardTitle.innerText = "Alegría";
          cardDesc.innerText = "Detectando sonrisa. Generando interfaz vibrante y optimista.";
          cardImage.style.backgroundImage = "url('images/happy.png')";
          break;

        case 'sad':
        case 'angry':
        case 'disgusted':
        case 'fearful':
          uiCard.classList.add('sad');
          bgSad.classList.add('active');

          cardBadge.innerText = "Modo Adaptativo";
          cardTitle.innerText = "Tensión";
          cardDesc.innerText = "Detectando estrés. Simplificando UI para reducir carga cognitiva.";
          cardImage.style.backgroundImage = "url('images/sad.png')";
          break;

        case 'neutral':
        case 'surprised':
        default:
          uiCard.classList.add('neutral');
          bgNeutral.classList.add('active');

          cardBadge.innerText = "Sistema Estable";
          cardTitle.innerText = "Neutral";
          cardDesc.innerText = "Interfaz balanceada. Detectando parámetros biométricos estables.";
          cardImage.style.backgroundImage = "url('images/neutral.png')";
          break;
      }
    }
  </script>
</body>

</html>